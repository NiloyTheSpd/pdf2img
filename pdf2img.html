<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF to JPG Converter</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- pdf.js library from Mozilla -->
    <script
      src="https://mozilla.github.io/pdf.js/build/pdf.mjs"
      type="module"
    ></script>
    <!-- JSZip library for creating zip files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .file-input-button {
        cursor: pointer;
      }
      .loader {
        border-top-color: #3b82f6; /* A nice blue color */
        -webkit-animation: spin 1s linear infinite;
        animation: spin 1s linear infinite;
      }
      @-webkit-keyframes spin {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-5xl mx-auto">
      <div
        class="bg-white rounded-2xl shadow-xl p-6 md:p-10 border border-gray-200"
      >
        <!-- Header Section -->
        <div class="text-center mb-8">
          <div
            class="inline-block bg-blue-100 text-blue-600 p-3 rounded-full mb-4"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
          </div>
          <h1 class="text-3xl md:text-4xl font-bold text-gray-800">
            PDF to Image Converter
          </h1>
          <p class="text-gray-500 mt-2 max-w-2xl mx-auto">
            Effortlessly convert your PDF pages into high-quality JPG images.
            Secure, private, and all within your browser.
          </p>
        </div>

        <!-- File Upload Section -->
        <div
          id="upload-box"
          class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center bg-gray-50 hover:border-blue-500 hover:bg-blue-50 transition-all duration-300"
        >
          <input type="file" id="pdf-file" accept=".pdf" class="hidden" />
          <label for="pdf-file" class="file-input-button">
            <div class="flex flex-col items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                />
              </svg>
              <p class="mt-2 text-lg font-semibold text-gray-700">
                Click to upload or drag & drop
              </p>
              <p class="text-sm text-gray-500">PDF files only</p>
            </div>
          </label>
          <p id="file-name" class="mt-4 text-sm text-gray-600 font-medium">
            No file selected
          </p>
        </div>

        <!-- Convert Button -->
        <div class="text-center mt-6">
          <button
            id="convert-btn"
            class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-12 rounded-lg hover:bg-blue-700 transition-all duration-300 shadow-md hover:shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed disabled:shadow-none"
            disabled
          >
            Convert to JPG
          </button>
        </div>

        <!-- Status and Loader Section -->
        <div id="status-container" class="text-center mt-6 hidden">
          <div
            class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mx-auto"
          ></div>
          <p id="status-text" class="text-gray-600 mt-3 font-medium"></p>
        </div>
      </div>

      <!-- Output Section -->
      <div id="output-section" class="mt-8 hidden">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold text-gray-800">Conversion Results</h2>
          <button
            id="download-zip-btn"
            class="bg-emerald-500 text-white font-semibold py-2 px-5 rounded-lg hover:bg-emerald-600 transition-colors duration-300 shadow-sm flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
              />
            </svg>
            Download All (.zip)
          </button>
        </div>
        <div
          id="output-container"
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
        >
          <!-- Converted images will be appended here -->
        </div>
      </div>
    </div>

    <script type="module">
      // Set the workerSrc for pdf.js
      const { pdfjsLib } = globalThis;
      pdfjsLib.GlobalWorkerOptions.workerSrc = `https://mozilla.github.io/pdf.js/build/pdf.worker.mjs`;

      // DOM element references
      const pdfFileInput = document.getElementById("pdf-file");
      const fileNameDisplay = document.getElementById("file-name");
      const convertBtn = document.getElementById("convert-btn");
      const statusContainer = document.getElementById("status-container");
      const statusText = document.getElementById("status-text");
      const outputSection = document.getElementById("output-section");
      const outputContainer = document.getElementById("output-container");
      const downloadZipBtn = document.getElementById("download-zip-btn");
      const uploadBox = document.getElementById("upload-box");

      let selectedFile = null;
      let convertedImages = []; // To store image data for zipping

      // --- Drag and Drop Functionality ---
      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        uploadBox.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        uploadBox.addEventListener(
          eventName,
          () => uploadBox.classList.add("bg-blue-100", "border-blue-500"),
          false
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        uploadBox.addEventListener(
          eventName,
          () => uploadBox.classList.remove("bg-blue-100", "border-blue-500"),
          false
        );
      });

      uploadBox.addEventListener("drop", handleDrop, false);

      function handleDrop(e) {
        let dt = e.dataTransfer;
        let files = dt.files;
        if (files.length > 0 && files[0].type === "application/pdf") {
          pdfFileInput.files = files;
          handleFileSelect(files[0]);
        } else {
          alert("Please drop a valid PDF file.");
        }
      }

      // --- File Selection ---
      pdfFileInput.addEventListener("change", (e) =>
        handleFileSelect(e.target.files[0])
      );

      function handleFileSelect(file) {
        selectedFile = file;
        if (selectedFile) {
          fileNameDisplay.textContent = selectedFile.name;
          convertBtn.disabled = false;
        } else {
          fileNameDisplay.textContent = "No file selected";
          convertBtn.disabled = true;
        }
      }

      // --- Conversion Logic ---
      convertBtn.addEventListener("click", async () => {
        if (!selectedFile) return;

        // Reset UI
        outputContainer.innerHTML = "";
        outputSection.classList.add("hidden");
        convertedImages = [];
        statusText.textContent = "Preparing your file...";
        statusContainer.classList.remove("hidden");
        convertBtn.disabled = true;
        pdfFileInput.disabled = true;

        try {
          const fileReader = new FileReader();
          fileReader.readAsArrayBuffer(selectedFile);
          fileReader.onload = async function () {
            const typedarray = new Uint8Array(this.result);
            const pdf = await pdfjsLib.getDocument({ data: typedarray })
              .promise;
            const numPages = pdf.numPages;
            statusText.textContent = `Found ${numPages} page(s). Starting conversion...`;

            for (let i = 1; i <= numPages; i++) {
              statusText.textContent = `Converting page ${i} of ${numPages}...`;
              const page = await pdf.getPage(i);
              const scale = 2.0;
              const viewport = page.getViewport({ scale });
              const canvas = document.createElement("canvas");
              const context = canvas.getContext("2d");
              canvas.height = viewport.height;
              canvas.width = viewport.width;
              await page.render({ canvasContext: context, viewport }).promise;

              const jpgUrl = canvas.toDataURL("image/jpeg", 0.9);
              convertedImages.push({
                name: `${selectedFile.name.replace(
                  /\.pdf$/i,
                  ""
                )}_page_${i}.jpg`,
                data: jpgUrl.split(",")[1], // Get base64 data
              });
              createImageCard(jpgUrl, i, selectedFile.name);
            }

            statusText.textContent = "Conversion complete!";
            outputSection.classList.remove("hidden");
            setTimeout(() => statusContainer.classList.add("hidden"), 2000);
          };
        } catch (error) {
          console.error("Error during PDF conversion:", error);
          statusText.textContent =
            "An error occurred. Please try a different file.";
        } finally {
          convertBtn.disabled = false;
          pdfFileInput.disabled = false;
        }
      });

      // --- ZIP and Download ---
      downloadZipBtn.addEventListener("click", () => {
        const zip = new JSZip();
        convertedImages.forEach((image) => {
          zip.file(image.name, image.data, { base64: true });
        });

        zip.generateAsync({ type: "blob" }).then(function (content) {
          const link = document.createElement("a");
          link.href = URL.createObjectURL(content);
          link.download = `${selectedFile.name.replace(/\.pdf$/i, "")}.zip`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });
      });

      // --- Create Image Card UI ---
      function createImageCard(jpgUrl, pageNum, originalFileName) {
        const baseName = originalFileName.replace(/\.pdf$/i, "");
        const downloadFileName = `${baseName}_page_${pageNum}.jpg`;
        const card = document.createElement("div");
        card.className =
          "bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-1 transition-transform duration-300 fade-in border";
        card.innerHTML = `
                <div class="p-3">
                    <img src="${jpgUrl}" alt="Page ${pageNum}" class="w-full h-auto rounded-md border border-gray-200">
                </div>
                <div class="p-4 bg-gray-50 border-t">
                    <p class="text-sm font-semibold text-gray-700 mb-2 truncate">Page ${pageNum}</p>
                    <a href="${jpgUrl}" download="${downloadFileName}" class="block w-full text-center bg-blue-500 text-white text-sm font-medium py-2 px-4 rounded-md hover:bg-blue-600 transition-colors duration-200">
                        Download JPG
                    </a>
                </div>
            `;
        outputContainer.appendChild(card);
      }
    </script>
  </body>
</html>
